# Steps to use the exported model as a container

1) Copy the exported model to your local machine

> gsutil -m cp -r gs://{path the exported model} .
    
Change the last name and remove the timestamp (not supported by the Docker container).
    
> mv model-export/tbl/tf_saved_model-<model-name>-<export-timestamp> model-export/tbl/<new-dir-name>

2) Pull the Docker cotainer with AutoML serving

> sudo docker pull gcr.io/cloud-automl-tables-public/model_server

3) Execute the model:
    
> docker run -v `pwd`/model-export/tbl/new_folder_name:/models/default/0000001 -p 8080:8080 -it gcr.io/cloud-automl-tables-public/model_server

In my case:
    
> docker run -v ~/automl-tables/model-export/tbl/fraud_model:/models/default/0000001 -p 8080:8080 -it gcr.io/cloud-automl-tables-public/model_server
    
4) Make local predictions

> curl -X POST --data @/tmp/request.json http://localhost:8080/predict


## Run My Machine
docker run -v ~/Users/renatoleite/Documents/ml/automl-tables/model-export/tbl/model:/models/default/0000001 -p 8080:8080 -it gcr.io/cloud-automl-tables-public/model_server

## Cloud Shell
docker run -v ~/automl-tables/model-export/tbl/fraud_model:/models/default/0000001 -p 8080:8080 -it gcr.io/cloud-automl-tables-public/model_server

## Example of a request
{ "instances": [ { "column_name_1": value, "column_name_2": value, … } , … ] }

## curl example
curl -X POST --data @./request.json http://localhost:8080/predict

## Payload example
{
    "instances": 
        [
            {
                "8496745483987845120":1,
                "282179763664060416":1,
                "2155677208650186752":1,
                "5614441722470727680":1,
                "9073206236291268608":1,
                "7920284731684421632":1,
                "4461520217863880704":1,
                "714525327891628032":1,
                "2443907584801898496":1,
                "1290986080195051520":1,
                "7055593603229286400":1,
                "3596829089408745472":1,
                "5902672098622439424":1,
                "8208515107836133376":1,
                "5326211346319015936":1,
                "3020368337105321984":1,
                "7632054355532709888":1,
                "1867446832498475008":1,
                "8784975860139556864":1,
                "4173289841712168960":1,
                "6479132850925862912":1,
                "2732137960953610240":1,
                "426294951739916288":1,
                "5037980970167304192":1,
                "7343823979380998144":1,
                "1579216456346763264":1,
                "3885059465560457216":1,
                "6190902474774151168":1,
                "1002755704043339776":1,
                "3308598713257033728":1
            }
        ]
}